<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">-- |</span><span>
</span><a name="line-2"></a><span class="hs-comment">-- Module: Parser.Game.Travel</span><span>
</span><a name="line-3"></a><span class="hs-comment">-- Description: Parsing Action token to Game's Action data.</span><span>
</span><a name="line-4"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Parser.Game.Travel</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-5"></a><span>
</span><a name="line-6"></a><span class="hs-keyword">import</span><span>           </span><a href="Parser.Errors.html"><span class="hs-identifier">Parser.Errors</span></a><span>
</span><a name="line-7"></a><span class="hs-keyword">import</span><span>           </span><a href="Extensions.Errors.html"><span class="hs-identifier">Extensions.Errors</span></a><span>
</span><a name="line-8"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Game.GameState.html"><span class="hs-identifier">Game.GameState</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">G</span><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><a href="Parser.Text.Tokens.html"><span class="hs-identifier">Parser.Text.Tokens</span></a><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">T</span><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">M</span><span>
</span><a name="line-11"></a><span>
</span><a name="line-12"></a><span class="hs-comment">-- | Converts '(T.LocNameStr, T.LocTravel)' to '(G.LocName, G.LocCanTravel)'. Get the 'T.LocMap' tokens and the name of the location to performs consistency check.</span><span>
</span><a name="line-13"></a><span class="hs-identifier">travel</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Parser.Text.Tokens.html#LocMap"><span class="hs-identifier hs-type">T.LocMap</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Parser.Text.Tokens.html#LocNameStr"><span class="hs-identifier hs-type">T.LocNameStr</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="Parser.Text.Tokens.html#LocNameStr"><span class="hs-identifier hs-type">T.LocNameStr</span></a><span class="hs-special">,</span><span> </span><a href="Parser.Text.Tokens.html#LocTravel"><span class="hs-identifier hs-type">T.LocTravel</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Either</span><span> </span><a href="Parser.Errors.html#LoaderError"><span class="hs-identifier hs-type">LoaderError</span></a><span> </span><span class="hs-special">(</span><a href="Game.GameState.html#LocName"><span class="hs-identifier hs-type">G.LocName</span></a><span class="hs-special">,</span><span> </span><a href="Game.GameState.html#LocCanTravel"><span class="hs-identifier hs-type">G.LocCanTravel</span></a><span class="hs-special">)</span><span>
</span><a name="line-14"></a><a name="travel"><a href="Parser.Game.Travel.html#travel"><span class="hs-identifier">travel</span></a></a><span> </span><a name="local-6989586621679064261"><a href="#local-6989586621679064261"><span class="hs-identifier">tLocs</span></a></a><span> </span><a name="local-6989586621679064262"><a href="#local-6989586621679064262"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679064263"><a href="#local-6989586621679064263"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679064263"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-15"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679064273"><a href="#local-6989586621679064273"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Parser.Text.Tokens.html#LocCannotTravel"><span class="hs-identifier hs-var">T.LocCannotTravel</span></a><span> </span><span class="hs-special">(</span><a href="Parser.Text.Tokens.html#Local"><span class="hs-identifier hs-var">T.Local</span></a><span> </span><a name="local-6989586621679064274"><a href="#local-6989586621679064274"><span class="hs-identifier">idL</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679064275"><a href="#local-6989586621679064275"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679064264"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621679064273"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><a href="Game.GameState.html#LocName"><span class="hs-identifier hs-var">G.LocName</span></a><span> </span><a href="#local-6989586621679064273"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="Game.GameState.html#LocCannotTravel"><span class="hs-identifier hs-var">G.LocCannotTravel</span></a><span> </span><a href="Game.GameState.html#CondLocal"><span class="hs-identifier hs-var">G.CondLocal</span></a><span> </span><span class="hs-special">(</span><a href="Game.GameState.html#CondId"><span class="hs-identifier hs-var">G.CondId</span></a><span> </span><a href="#local-6989586621679064274"><span class="hs-identifier hs-var">idL</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679064275"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span>
</span><a name="line-16"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679064276"><a href="#local-6989586621679064276"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Parser.Text.Tokens.html#LocCannotTravel"><span class="hs-identifier hs-var">T.LocCannotTravel</span></a><span> </span><span class="hs-special">(</span><a href="Parser.Text.Tokens.html#Global"><span class="hs-identifier hs-var">T.Global</span></a><span> </span><a name="local-6989586621679064277"><a href="#local-6989586621679064277"><span class="hs-identifier">idG</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679064278"><a href="#local-6989586621679064278"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679064264"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621679064276"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><a href="Game.GameState.html#LocName"><span class="hs-identifier hs-var">G.LocName</span></a><span> </span><a href="#local-6989586621679064276"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="Game.GameState.html#LocCannotTravel"><span class="hs-identifier hs-var">G.LocCannotTravel</span></a><span> </span><a href="Game.GameState.html#CondGlobal"><span class="hs-identifier hs-var">G.CondGlobal</span></a><span> </span><span class="hs-special">(</span><a href="Game.GameState.html#CondId"><span class="hs-identifier hs-var">G.CondId</span></a><span> </span><a href="#local-6989586621679064277"><span class="hs-identifier hs-var">idG</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679064278"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">;</span><span>
</span><a name="line-17"></a><span>    </span><span class="hs-special">(</span><a name="local-6989586621679064279"><a href="#local-6989586621679064279"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><a href="Parser.Text.Tokens.html#LocCanTravel"><span class="hs-identifier hs-var">T.LocCanTravel</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679064264"><span class="hs-identifier hs-var">check</span></a><span> </span><a href="#local-6989586621679064279"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-special">(</span><a href="Game.GameState.html#LocName"><span class="hs-identifier hs-var">G.LocName</span></a><span> </span><a href="#local-6989586621679064279"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">,</span><span> </span><a href="Game.GameState.html#LocCanTravel"><span class="hs-identifier hs-var">G.LocCanTravel</span></a><span class="hs-special">)</span><span>
</span><a name="line-18"></a><span>    </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a href="Parser.Text.Tokens.html#LocCannotTravel"><span class="hs-identifier hs-var">T.LocCannotTravel</span></a><span> </span><a href="Parser.Text.Tokens.html#None"><span class="hs-identifier hs-var">T.None</span></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Extensions.Errors.html#errCant"><span class="hs-identifier hs-var">errCant</span></a><span>
</span><a name="line-19"></a><span>    </span><span class="hs-keyword">where</span><span>
</span><a name="line-20"></a><span>      </span><a name="local-6989586621679064264"><a href="#local-6989586621679064264"><span class="hs-identifier">check</span></a></a><span> </span><a name="local-6989586621679064267"><a href="#local-6989586621679064267"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679064268"><a href="#local-6989586621679064268"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679064265"><span class="hs-identifier hs-var">isThereLoc</span></a><span> </span><a href="#local-6989586621679064267"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679064268"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-operator hs-var">&gt;&gt;</span><span> </span><a href="#local-6989586621679064266"><span class="hs-identifier hs-var">cantSameLoc</span></a><span> </span><a href="#local-6989586621679064267"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679064268"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-21"></a><span>      </span><a name="local-6989586621679064265"><a href="#local-6989586621679064265"><span class="hs-identifier">isThereLoc</span></a></a><span> </span><a name="local-6989586621679064269"><a href="#local-6989586621679064269"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679064270"><a href="#local-6989586621679064270"><span class="hs-identifier">r</span></a></a><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-identifier hs-var">M.member</span><span> </span><a href="#local-6989586621679064269"><span class="hs-identifier hs-var">k</span></a><span> </span><a href="#local-6989586621679064261"><span class="hs-identifier hs-var">tLocs</span></a><span>
</span><a name="line-22"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679064270"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-23"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-string">&quot;There is no such location to travel!&quot;</span><span>
</span><a name="line-24"></a><span>      </span><a name="local-6989586621679064266"><a href="#local-6989586621679064266"><span class="hs-identifier">cantSameLoc</span></a></a><span> </span><a name="local-6989586621679064271"><a href="#local-6989586621679064271"><span class="hs-identifier">k</span></a></a><span> </span><a name="local-6989586621679064272"><a href="#local-6989586621679064272"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679064271"><span class="hs-identifier hs-var">k</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679064262"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span>        </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">Left</span><span> </span><span class="hs-string">&quot;You can't have on travel list the same place you are in!&quot;</span><span>
</span><a name="line-26"></a><span>        </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">Right</span><span> </span><a href="#local-6989586621679064272"><span class="hs-identifier hs-var">r</span></a><span>
</span><a name="line-27"></a></pre></body></html>